test_name: test_filter_resolution_for_derived_metrics_with_common_filtered_metric
test_filename: test_spec_lookup.py
docstring:
  Checks that there are 2 filter spec resolutions even if the metric + filter combination is repeated.

      The resolutions will have a different filter_location_path.
---
FilterSpecResolutionLookUp(
  spec_resolutions=(
    FilterSpecResolution(
      lookup_key=ResolvedSpecLookUpKey(
        filter_location=WhereFilterLocation(
          location_type=INPUT_METRIC,
          metric_references=(
            MetricReference(
              element_name='monthly_metric_0',
            ),
          ),
        ),
        call_parameter_set=TimeDimensionCallParameterSet(
          time_dimension_reference=TimeDimensionReference(
            element_name='metric_time',
          ),
        ),
      ),
      where_filter_intersection=PydanticWhereFilterIntersection(
        where_filters=[
          PydanticWhereFilter(
            where_sql_template=('{{ '
             "TimeDimension('metric_time') "
             "}} = '2020-01-01'"),
          ),
        ],
      ),
      resolved_linkable_element_set=AnnotatedSpecLinkableElementSet(
        annotated_specs=(
          AnnotatedSpec(
            element_type=TIME_DIMENSION,
            element_name='metric_time',
            time_grain=ExpandedTimeGranularity(
              name='month',
              base_granularity=MONTH,
            ),
            element_properties=(METRIC_TIME,),
            origin_semantic_model_names=(
              'monthly_measures_source',
            ),
            derived_from_semantic_model_names=(
              'monthly_measures_source',
            ),
          ),
        ),
      ),
      spec_pattern=TimeDimensionPattern(
        parameter_set=SpecPatternParameterSet(
          fields_to_compare=(DATE_PART, ELEMENT_NAME, ENTITY_LINKS),
          element_name='metric_time',
        ),
      ),
      filter_location_path=MetricFlowQueryResolutionPath(
        resolution_path_nodes=(
          QueryGroupByItemResolutionNode(node_id=qr_0),
          MetricGroupByItemResolutionNode(node_id=mtr_1),
          MetricGroupByItemResolutionNode(node_id=mtr_0),
        ),
      ),
      object_builder_str="TimeDimension('metric_time')",
    ),
    FilterSpecResolution(
      lookup_key=ResolvedSpecLookUpKey(
        filter_location=WhereFilterLocation(
          location_type=INPUT_METRIC,
          metric_references=(
            MetricReference(
              element_name='monthly_metric_0',
            ),
          ),
        ),
        call_parameter_set=TimeDimensionCallParameterSet(
          time_dimension_reference=TimeDimensionReference(
            element_name='metric_time',
          ),
        ),
      ),
      where_filter_intersection=PydanticWhereFilterIntersection(
        where_filters=[
          PydanticWhereFilter(
            where_sql_template=('{{ '
             "TimeDimension('metric_time') "
             "}} = '2020-01-01'"),
          ),
        ],
      ),
      resolved_linkable_element_set=AnnotatedSpecLinkableElementSet(
        annotated_specs=(
          AnnotatedSpec(
            element_type=TIME_DIMENSION,
            element_name='metric_time',
            time_grain=ExpandedTimeGranularity(
              name='month',
              base_granularity=MONTH,
            ),
            element_properties=(METRIC_TIME,),
            origin_semantic_model_names=(
              'monthly_measures_source',
            ),
            derived_from_semantic_model_names=(
              'monthly_measures_source',
            ),
          ),
        ),
      ),
      spec_pattern=TimeDimensionPattern(
        parameter_set=SpecPatternParameterSet(
          fields_to_compare=(DATE_PART, ELEMENT_NAME, ENTITY_LINKS),
          element_name='metric_time',
        ),
      ),
      filter_location_path=MetricFlowQueryResolutionPath(
        resolution_path_nodes=(
          QueryGroupByItemResolutionNode(node_id=qr_0),
          MetricGroupByItemResolutionNode(node_id=mtr_3),
          MetricGroupByItemResolutionNode(node_id=mtr_2),
        ),
      ),
      object_builder_str="TimeDimension('metric_time')",
    ),
  ),
)
